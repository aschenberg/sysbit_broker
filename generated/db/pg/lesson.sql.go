// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: lesson.sql

package pg

import (
	"context"

	"github.com/jackc/pgx/v5/pgtype"
)

const addLesson = `-- name: AddLesson :one
INSERT INTO lesson (lesson_code,title) 
VALUES($1,$2) RETURNING lesson_id, lesson_code, title
`

type AddLessonParams struct {
	LessonCode string
	Title      string
}

func (q *Queries) AddLesson(ctx context.Context, arg AddLessonParams) (Lesson, error) {
	row := q.db.QueryRow(ctx, addLesson, arg.LessonCode, arg.Title)
	var i Lesson
	err := row.Scan(&i.LessonID, &i.LessonCode, &i.Title)
	return i, err
}

const deleteLesson = `-- name: DeleteLesson :exec
DELETE FROM lesson WHERE lesson_id = $1
`

func (q *Queries) DeleteLesson(ctx context.Context, lessonID int32) error {
	_, err := q.db.Exec(ctx, deleteLesson, lessonID)
	return err
}

const getLessonDetailByCode = `-- name: GetLessonDetailByCode :many
SELECT a.lesson_id, lesson_code, title, content_id, b.lesson_id, b.page_id, lang, step, content, c.page_id, c.lesson_id, page FROM lesson as a 
LEFT JOIN lesson_content as b ON a.lesson_id = b.lesson_id 
LEFT JOIN lesson_page as c ON b.page_id = c.page_id 
WHERE a.lesson_code = $1 AND b.lang = ANY ($2) ORDER BY c.page
`

type GetLessonDetailByCodeParams struct {
	LessonCode string
	Lang       []string
}

type GetLessonDetailByCodeRow struct {
	LessonID   int32
	LessonCode string
	Title      string
	ContentID  pgtype.Int4
	LessonID_2 pgtype.Int4
	PageID     pgtype.Int4
	Lang       pgtype.Text
	Step       pgtype.Int4
	Content    pgtype.Text
	PageID_2   pgtype.Int4
	LessonID_3 pgtype.Int4
	Page       pgtype.Int4
}

func (q *Queries) GetLessonDetailByCode(ctx context.Context, arg GetLessonDetailByCodeParams) ([]GetLessonDetailByCodeRow, error) {
	rows, err := q.db.Query(ctx, getLessonDetailByCode, arg.LessonCode, arg.Lang)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetLessonDetailByCodeRow{}
	for rows.Next() {
		var i GetLessonDetailByCodeRow
		if err := rows.Scan(
			&i.LessonID,
			&i.LessonCode,
			&i.Title,
			&i.ContentID,
			&i.LessonID_2,
			&i.PageID,
			&i.Lang,
			&i.Step,
			&i.Content,
			&i.PageID_2,
			&i.LessonID_3,
			&i.Page,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getLessonHeader = `-- name: GetLessonHeader :many
SELECT lesson_id, lesson_code, title FROM lesson
ORDER BY lesson_code ASC
`

func (q *Queries) GetLessonHeader(ctx context.Context) ([]Lesson, error) {
	rows, err := q.db.Query(ctx, getLessonHeader)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Lesson{}
	for rows.Next() {
		var i Lesson
		if err := rows.Scan(&i.LessonID, &i.LessonCode, &i.Title); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
